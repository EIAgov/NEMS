!FILE NAME:      RTEK
!DATE MODIFIED:  May 30, 2023
!USED BY:        Main subroutine of the National Energy Modeling System (NEMS)
!                Residential Demand Module (RDM)
!DEFINITION:     Technology data inputs sourced from RSMESS.xlsx (RSCLASS, RSMEQP, and RSMSHL) & RSSWITCH.txt input files
!UNITS:          Unitless
!DIMENSION:      Various
!SPECIAL CONSTRAINTS:  None
!ORGANIZATION OF DATA:  Various non-RSMESS inputs listed at end
!SOURCES:        Not applicable
!COMMENT:        Revise RTBASEFF range to 2020 for new RECS base year


!PARAMETERS

  INTEGER MNUMRTCL,       & ! PARAMETER: MAX # RSCLASS RECORDS
          MNUMRTTY,       & ! PARAMETER: MAX # RSMEQP RECORDS
          MNUMENDU,       & ! PARAMETER: MAX # END USES + 1
          MNUMBLDG,       & ! PARAMETER: EXACT # OF BUILDING TYPES
          MNUMCENDIV,     & ! PARAMETER: 9 U.S. CENSUS DIVISIONS
          MNUMFUEL,       & ! PARAMETER: EXACT # OF RTEK FUELS
          MNUMHVAC,       & ! PARAMETER: MAX # HVAC RECORDS
          COSTTRSW          ! PARAMETER: = 1, USE COST TREND FUNCTION
                            !            = 0, DON'T USE FUNCTION

  PARAMETER(MNUMRTCL=50)   ! INCREASE IF RSCLASS HAS >  50 RECORDS
  PARAMETER(MNUMRTTY=3200) ! INCREASE IF RSMEQP HAS > 3200 RECORDS
  PARAMETER(MNUMHVAC=3500) ! INCREASE IF RSMSHL HAS > 3500 RECORDS
  PARAMETER(MNUMENDU=13)   ! INCREASE IF > 13 END USES
  PARAMETER(MNUMBLDG=3)    ! INCREASE IF > 3 BUILDING TYPES
  PARAMETER(MNUMCENDIV=9)  ! 9 U.S. CENSUS DIVISIONS
  PARAMETER(MNUMFUEL=8)    ! INCREASE IF >  8 RTEK FUELS
  PARAMETER(COSTTRSW=1)    ! SET = 0 TO TURN OFF FUNCTION EQCOST


!COUNTERS AND POINTERS (COMPUTED IN SUBROUTINE RTEKREAD)

  INTEGER &
    RTCLCNT,               & ! COUNTER: ACTUAL # RSCLASS RECORDS
    RTTYCNT,               & ! COUNTER: ACTUAL # RSMEQP RECORDS
    RTEUCNT,               & ! COUNTER: NUMBER OF END USES
    RTCLEUPT(MNUMENDU),    & ! POINTER: RTxxEUPT(1)=0 (xx=CL for RSCLASS or TY for RSMEQP)
    RTTYEUPT(MNUMENDU),    & ! POINTER: RTxxEUPT(J+1)=LAST RECORD # IN RSCLASS or RSMEQP DATA FOR END USE J
    RTTYPECT(MNUMENDU)       ! POINTER: RTTYPECT(1)=0
                             ! POINTER: RTTYPECT(J+1)=LAST TYPE # IN TYPE ARRAYS FOR END USE J


!INTEGER INPUT FROM RSCLASS

  INTEGER &
    RTCLENDU(MNUMRTCL),    & ! END USE NUMBER FROM RSCLASS
                             !  WHERE:
                             !   1 = SPACE HEATING
                             !   2 = SPACE COOLING
                             !   3 = CLOTHES WASHING
                             !   4 = DISHWASHING
                             !   5 = WATER HEATING
                             !   6 = COOKING
                             !   7 = CLOTHES DRYING
                             !   8 = FOOD REFRIGERATION
                             !   9 = FOOD FREEZING
    RTCLEQCL(MNUMRTCL),    & ! EQUIPMENT CLASS NUMBER FROM RSCLASS
    RTCLTYPT(MNUMRTCL),    & ! ASSOCIATES A CLASS TO SPECIFIC TYPE
    RTCLPNTR(MNUMRTCL),    & ! GENERAL PURPOSE POINTER
    RTCLREPL(MNUMRTCL),    & ! REPLACEMENT EQUIPMENT POINTER
    RTFUEL(MNUMRTCL),      & ! RTEK FUEL NUMBER FOR EQUIPMENT CLASS
                             !   1 = DISTILLATE FUEL OIL
                             !   2 = PROPANE
                             !   3 = NATURAL GAS
                             !   4 = ELECTRICITY
                             !   5 = KEROSENE (NOW INCLUDED WITH DISTILLATE FUEL OIL)
                             !   6 = WOOD
    RTFFAN(MNUMRTCL),      & ! FLAG: = 1 HAS FURNACE FAN
                             !       = 0 NO FURNACE FAN
    RTMINLIF(MNUMRTCL),    & ! MINIMUM LIFE FOR THIS EQUIPMENT CLASS
    RTMAXLIF(MNUMRTCL)       ! MAXIMUM LIFE FOR THIS EQUIPMENT CLASS

!REAL INPUT FROM RSCLASS

  REAL*4 &
    RTBASEFF(2020:ENDYR,MNUMRTCL),  & ! BASE EFFICIENCY (ENSURE THAT START YEAR IS ALWAYS SET TO CURRENT RECSYR FROM RESDREP)
    RTALPHA(MNUMRTCL),              & ! EQUIPMENT LIFE ALPHA PARAMETER
    RTK(MNUMRTCL),                  & ! EQUIPMENT LIFE WEIBULL K PARAMETER
    RTLAMBDA(MNUMRTCL),             & ! EQUIPMENT LIFE WEIBULL LAMBDA PARAMETER
    RTFCBETA(MNUMRTCL),             & ! EQUIPMENT CHOICE BETA; NEW CONSTRUCTION (LOGIT PARAMETER)
    RTSWFACT(MNUMRTCL),             & ! EQUIPMENT CHOICE SWITCH FACTOR; REPLACE EXISTING
    RTSWBETA(MNUMRTCL),             & ! EQUIPMENT CHOICE BETA; REPLACE EXISTING (LOGIT PARAMETER)
    RTSWBIAS(MNUMRTCL)                ! EQUIPMENT CHOICE BIAS; REPLACE EXISTING (LOGIT PARAMETER)

!CHARACTER INPUT FROM RSCLASS

  CHARACTER*10 RTCLNAME(MNUMRTCL)     ! EQUIPMENT CLASS NAME


!INTEGER INPUT FROM RSMEQP

  INTEGER &
    RTEKDOLLARYR,          & ! DOLLAR YEAR OF TECHNOLOGY COSTS
    RTTYENDU(MNUMRTTY),    & ! END USE NUMBER FROM RSCLASS (SAME END USE NUMBERS AS ABOVE)
    RTTYEQCL(MNUMRTTY),    & ! EQUIPMENT CLASS NUMBER FROM RSCLASS
    RTEQTYPE(MNUMRTTY),    & ! EQUIPMENT TYPE NUMBER (SPECIFIC)
    RTINITYR(MNUMRTTY),    & ! INITIAL YEAR FOR THIS EQUIPMENT TYPE
    RTLASTYR(MNUMRTTY),    & ! LAST YEAR FOR THIS EQUIPMENT TYPE
    RTCENDIV(MNUMRTTY),    & ! CENSUS DIVISION POINTER FOR RSMEQP TECHNOLOGIES
    HVACPNTR(MNUMRTTY),    & ! POINTER TO LINK COOLING TO HEATING AND BUILDING ENVELOPE (SHELL)
    RTTYPNTR(MNUMRTTY)       !  <0 INDICATES ROOM AIR CONDITIONER
                             !  =0 INDICATES CENTRAL AC (NOT HP)
                             !  >0 RTTYPNTR FOR COOLING COMPONENT OF HP SAME AS HEATING COMPONENT OF SAME TECHNOLOGY

!REAL INPUT FROM RSMEQP

  REAL*4 &
    CWMEF(MNUMRTTY),       & ! MODIFIED ENERGY FACTOR FOR CLOTHESWASHERS USED FOR CHOICE ONLY
    LOADADJ(MNUMRTTY),     & ! HOT WATER HEATER LOAD ADJUSTMENT FOR H-AXIS WASHERS, ETC
    RTEQEFF(MNUMRTTY),     & ! EQUIPMENT EFFICIENCY (UNITS MAY VARY BY END USE)
    RTEQCOST(MNUMRTTY),    & ! CAPITAL COST IN RTEKDOLLARYR DOLLARS
    RTRECOST(MNUMRTTY),    & ! RETAIL COST IN RTEKDOLLARYR DOLLARS
    RTEQSUB(MNUMRTTY),     & ! FEDERAL SUBSIDY VALUE REPLACEMENT EQUIPMENT IN RTEKDOLLARYR DOLLARS
    RTRESUB(MNUMRTTY),     & ! FEDERAL SUBSIDY VALUE NEW EQUIPMENT IN RTEKDOLLARYR DOLLARS
    RTEQSUBN(MNUMRTTY),    & ! NON-FEDERAL SUBSIDY VALUE REPLACEMENT EQUIPMENT IN RTEKDOLLARYR DOLLARS
    RTRESUBN(MNUMRTTY),    & ! NON-FEDERAL SUBSIDY VALUE NEW EQUIPMENT IN RTEKDOLLARYR DOLLARS
    RTEQSUB111D(MNUMRTTY), & ! SUBSIDY VALUE REPLACEMENT EQUIPMENT FOR MODELING EPA111D IN RTEKDOLLARYR DOLLARS
    RTRESUB111D(MNUMRTTY), & ! SUBSIDY VALUE NEW EQUIP FOR MODELING EPA111D IN RTEKDOLLARYR DOLLARS
    RTCOSTP1(MNUMRTTY),    & ! FUNCTION EQCOST PARAMETER1 (START YEAR)
    RTCOSTP2(MNUMRTTY),    & ! FUNCTION EQCOST PARAMETER2
    RTCOSTP3(MNUMRTTY),    & ! FUNCTION EQCOST PARAMETER3
    RTECBTA1(MNUMRTTY),    & ! EFFICIENCY CHOICE BETA1 (LOGIT PARAMETER)
    RTECBTA2(MNUMRTTY),    & ! EFFICIENCY CHOICE BETA2 (LOGIT PARAMETER)
    RTECBTA3(MNUMRTTY),    & ! EFFICIENCY CHOICE BETA3 (LOGIT PARAMETER)
    RTECBIAS(MNUMRTTY)       ! EFFICIENCY CHIOCE BIAS  (LOGIT PARAMETER)

!CHARACTER INPUT FROM RSMEQP

  CHARACTER*10 &
    RTMATURE(MNUMRTTY),    & ! MATURE, ADOLESCENT, OR INFANT TECHNOLOGY
    RTTYNAME(MNUMRTTY)       ! EQUIPMENT TYPE NAME


!COMMON BLOCK FOR ALL RTEK VARIABLES

  COMMON/RTEK/ RTCLCNT, RTTYCNT, RTEUCNT, RTCLEUPT, RTTYEUPT, RTTYPECT, RTCLENDU, RTCLEQCL, RTCLTYPT, RTCLPNTR, RTCLREPL, &
    RTFUEL, RTFFAN, RTMINLIF, RTMAXLIF, RTBASEFF, RTALPHA, RTK, RTLAMBDA, RTFCBETA, RTSWFACT, RTSWBETA, RTSWBIAS, RTCLNAME, &
    RTEKDOLLARYR, RTTYENDU, RTTYEQCL,RTEQTYPE, RTINITYR, RTLASTYR, RTCENDIV, HVACPNTR, RTTYPNTR, CWMEF, LOADADJ, &
    RTEQEFF, RTEQCOST, RTRECOST, RTEQSUB, RTRESUB, RTEQSUBN, RTRESUBN, RTEQSUB111D, RTRESUB111D, RTCOSTP1, RTCOSTP2, &
    RTCOSTP3, RTECBTA1, RTECBTA2, RTECBTA3, RTECBIAS, RTMATURE, RTTYNAME, RTFCBIAS


!INTEGER INPUT FROM RSMSHL FILE

  INTEGER &
    RSHLDOLLARYR,          & ! DOLLAR YEAR OF BUILDING ENVELOPE (SHELL) PACKAGE COSTS
    RSCENDIV(MNUMHVAC),    & ! CENSUS DIVISION
    RSBTYPE(MNUMHVAC),     & ! BUILDING TYPE 1-SF, 2-MF, 3-MOBILE
    HVHTEQCL(MNUMHVAC),    & ! HEATING EQUIPMENT CLASS (CORRESPONDS TO HEATING CLASS IN RSCLASS)
    HVHTEQTY(MNUMHVAC),    & ! HEATING EQUIPMENT TYPE (CORRESPONDS TO HEATING TYPE IN RSCLASS)
    HVCLEQCL(MNUMHVAC),    & ! COOLING EQUIPMENT CLASS (CORRESPONDS TO COOLING CLASS IN RSCLASS)
    HVCLEQTY(MNUMHVAC),    & ! COOLING EQUIPMENT TYPE (CORRESPONDS TO COOLING TYPE IN RSCLASS)
    HVFYEAR(MNUMHVAC),     & ! FIRST YEAR HVAC PACKAGE AVAILABLE
    HVLYEAR(MNUMHVAC),     & ! LAST YEAR HVAC PACKAGE AVAILABLE
    HVPACKG(MNUMHVAC)        ! BUILDING ENVELOPE (SHELL) PACKAGE NUMBER: 1-NO IECC, 2-IECC 2009, 3-ESTAR, 4-40%, 5-PATH (50%)

!REAL INPUT FROM RSMSHL FILE

  REAL*4 &
    HVHEATFACTOR(MNUMHVAC), & ! HEATING FACTOR FOR SQUARE FOOTAGE
    HVCOOLFACTOR(MNUMHVAC), & ! COOLING FACTOR FOR SQUARE FOOTAGE
    HTSHEFF(MNUMHVAC),      & ! HEATING BUILDING ENVELOPE (SHELL) EFFICIENCY FACTOR
    CLSHEFF(MNUMHVAC),      & ! COOLING BUILDING ENVELOPE (SHELL) EFFICIENCY FACTOR
    HTSHBASE(MNUMHVAC),     & ! HEATING BUILDING ENVELOPE (SHELL) EFFICIENCY FACTOR BASE FOR OPERATING COST
    CLSHBASE(MNUMHVAC),     & ! COOLING BUILDING ENVELOPE (SHELL) EFFICIENCY FACTOR BASE FOR OPERATING COST
    SHELCOST(MNUMHVAC),     & ! COST FOR BUILDING ENVELOPE (SHELL) MEASURES IN RSHLDOLLARYR DOLLARS
    SHELSUB(MNUMHVAC),      & ! SUBSIDY AMOUNT FOR BUILDING ENVELOPE (SHELL) MEASURES IN RSHLDOLLARYR DOLLARS
    SHELSUB111D(MNUMHVAC)     ! SUBSIDY AMOUNT FOR BUILDING ENVELOPE (SHELL) MEASURES FOR MODELING EPA111D IN RSHLDOLLARYR DOLLARS


!CHARACTER INPUT FROM RSMSHL

  CHARACTER*14 &
    HVPGNAME(MNUMHVAC)        ! BUILDING ENVELOPE (SHELL) PACKAGE NAME


!COMMON BLOCK FOR ALL BUILDING ENVELOPE VARIABLES

  COMMON/HVACDATA/ RSHLDOLLARYR, RSCENDIV, RSBTYPE, HVHTEQCL, HVHTEQTY, &
    HVCLEQCL, HVCLEQTY, HVFYEAR, HVLYEAR, HVPACKG, HVHEATFACTOR, HVCOOLFACTOR, &
    HTSHEFF, CLSHEFF, HTSHBASE, CLSHBASE, SHELCOST, SHELSUB, SHELSUB111D, HVPGNAME


!REAL INPUT FROM RSSWITCH

  REAL*4 &
    RTFCBIAS(11,MNUMBLDG,MNUMCR-2)  ! EQUIPMENT CHOICE BIAS; NEW CONSTRUCTION (LOGIT PARAMETER)